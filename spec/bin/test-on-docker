#! /usr/bin/env bash
set -e

# default versions if none in env
export MONGODB_VERSION=${MONGODB_VERSION:=5}
export NODEJS_VERSION=${NODEJS_VERSION:=16}

VARIETY_VERSION=$(node -p -e "require('./package.json').version")

echo
echo "****************************************"
echo "* "
echo "* Variety v$VARIETY_VERSION"
echo "* "
echo "* NodeJS  v$NODEJS_VERSION"
echo "* MongoDB v$MONGODB_VERSION"
echo "* "
echo "* $(docker --version)"
echo "* "
echo "****************************************"
echo

echo "Building & running docker compose tests"

docker compose --verbose up --build --abort-on-container-exit

